<!DOCTYPE html>
<html>
<head>
  <title>360 панорама</title>
  <style>html,body{margin:0;height:100%;overflow:hidden;}#viewer{width:100%;height:100%;}</style>
</head>
<body>
<div id="viewer"></div>

<!-- Библиотека three.js (работает из РФ!) -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
const container = document.getElementById('viewer');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 1, 1100);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(container.clientWidth, container.clientHeight);
container.appendChild(renderer.domElement);

const geometry = new THREE.SphereGeometry(500, 60, 40);
geometry.scale(-1, 1, 1);

const texture = new THREE.TextureLoader().load('./IMG_20181020_183652_00_012.jpg');
const material = new THREE.MeshBasicMaterial({map: texture});
const mesh = new THREE.Mesh(geometry, material);
scene.add(mesh);

let lon = 0, lat = 0, isUserInteracting = false;

container.addEventListener('mousedown', e => {
  isUserInteracting = true;
  const startX = e.clientX, startY = e.clientY;
  const startLon = lon, startLat = lat;
  
  const onMove = e => {
    lon = startLon + (startX - e.clientX) * 0.1;
    lat = startLat + (e.clientY - startY) * 0.1;
  };
  
  const onUp = () => {
    isUserInteracting = false;
    container.removeEventListener('mousemove', onMove);
    container.removeEventListener('mouseup', onUp);
  };
  
  container.addEventListener('mousemove', onMove);
  container.addEventListener('mouseup', onUp);
});

function animate() {
  requestAnimationFrame(animate);
  if (!isUserInteracting) lon += 0.0005;
  lat = Math.max(-85, Math.min(85, lat));
  const phi = THREE.MathUtils.degToRad(90 - lat);
  const theta = THREE.MathUtils.degToRad(lon);
  camera.position.x = 500 * Math.sin(phi) * Math.cos(theta);
  camera.position.y = 500 * Math.cos(phi);
  camera.position.z = 500 * Math.sin(phi) * Math.sin(theta);
  camera.lookAt(scene.position);
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
