<!DOCTYPE html>
<html>
<head>
  <title>360 панорама</title>
  <style>
    * { margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; background: black; }
    #viewer { 
      width: 100%; 
      height: 100%; 
      position: relative; 
      cursor: grab; 
    }
    #viewer:active { cursor: grabbing; }
    #panorama { 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
      transition: transform 0.1s; 
    }
    #error { 
      color: white; 
      text-align: center; 
      padding-top: 50px; 
      font-family: Arial; 
    }
  </style>
</head>
<body>
<div id="viewer">
  <img id="panorama" src="./IMG_20181020_183652_00_012.jpg" crossorigin="anonymous">
</div>

<script>
const viewer = document.getElementById('viewer');
const panorama = document.getElementById('panorama');

let isDragging = false;
let startX = 0, startY = 0;
let rotX = 0, rotY = 0;
let targetRotX = 0, targetRotY = 0;

panorama.onerror = function() {
  document.body.innerHTML = '<div id="error">❌ Фото не найдено: IMG_20181020_183652_00_012.jpg<br>Проверь название файла!</div>';
};

viewer.addEventListener('mousedown', (e) => {
  isDragging = true;
  startX = e.clientX;
  startY = e.clientY;
});

viewer.addEventListener('mousemove', (e) => {
  if (!isDragging) return;
  
  const deltaX = e.clientX - startX;
  const deltaY = e.clientY - startY;
  
  targetRotY += deltaX * 0.01;
  targetRotX += deltaY * 0.01;
  targetRotX = Math.max(-Math.PI/3, Math.min(Math.PI/3, targetRotX));
  
  startX = e.clientX;
  startY = e.clientY;
});

viewer.addEventListener('mouseup', () => {
  isDragging = false;
});

viewer.addEventListener('mouseleave', () => {
  isDragging = false;
});

// Touch для мобильных
viewer.addEventListener('touchstart', (e) => {
  isDragging = true;
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
}, { passive: false });

viewer.addEventListener('touchmove', (e) => {
  if (!isDragging) return;
  e.preventDefault();
  
  const deltaX = e.touches[0].clientX - startX;
  const deltaY = e.touches[0].clientY - startY;
  
  targetRotY += deltaX * 0.01;
  targetRotX += deltaY * 0.01;
  targetRotX = Math.max(-Math.PI/3, Math.min(Math.PI/3, targetRotX));
  
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
}, { passive: false });

viewer.addEventListener('touchend', () => {
  isDragging = false;
});

function animate() {
  requestAnimationFrame(animate);
  
  // Плавная анимация к цели
  rotY += (targetRotY - rotY) * 0.1;
  rotX += (targetRotX - rotX) * 0.1;
  
  // Авто-вращение
  if (!isDragging) targetRotY += 0.0005;
  
  panorama.style.transform = 
    `rotateX(${rotX}rad) rotateY(${rotY}rad)`;
}

animate();
</script>
</body>
</html>
