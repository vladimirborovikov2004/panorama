<!DOCTYPE html>
<html>
<head>
  <title>360 панорама</title>
  <style>html,body{margin:0;height:100%;overflow:hidden;}#viewer{width:100%;height:100%;}</style>
</head>
<body>
<div id="viewer"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
<script>
const container = document.getElementById('viewer');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 1, 1100);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(container.clientWidth, container.clientHeight);
container.appendChild(renderer.domElement);

const geometry = new THREE.SphereGeometry(500, 60, 40);
geometry.scale(-1, 1, 1);
const texture = new THREE.TextureLoader().load('./IMG_20181020_183652_00_012.jpg');
const material = new THREE.MeshBasicMaterial({map: texture});
const mesh = new THREE.Mesh(geometry, material);
scene.add(mesh);

let lon = 0, lat = 0, isUserInteracting = false;
let onPointerDownPointerX = 0, onPointerDownPointerY = 0;
let onPointerDownLon = 0, onPointerDownLat = 0;

container.addEventListener('mousedown', e => {
  isUserInteracting = true;
  onPointerDownPointerX = e.clientX;
  onPointerDownPointerY = e.clientY;
  onPointerDownLon = lon;
  onPointerDownLat = lat;
});

container.addEventListener('mousemove', e => {
  if (!isUserInteracting) return;
  lon = (onPointerDownPointerX - e.clientX) * 0.1 + onPointerDownLon;
  lat = (e.clientY - onPointerDownPointerY) * 0.1 + onPointerDownLat;
});

container.addEventListener('mouseup', () => isUserInteracting = false);

function animate() {
  requestAnimationFrame(animate);
  if (!isUserInteracting) lon += 0.0005;
  lat = Math.max(-85, Math.min(85, lat));
  const phi = THREE.MathUtils.degToRad(90 - lat);
  const theta = THREE.MathUtils.degToRad(lon);
  camera.position.x = 500 * Math.sin(phi) * Math.cos(theta);
  camera.position.y = 500 * Math.cos(phi);
  camera.position.z = 500 * Math.sin(phi) * Math.sin(theta);
  camera.lookAt(scene.position);
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
